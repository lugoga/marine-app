---
title: "MarcoSouth December Meeting"
author: "Masumbuko Semba"
date: "12/27/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
The preliminary meeting was held in IMS building at Buyu on December 27, 2021. 

## Agenda
The meeting with the stakeholder that is organized for December 2017
Review of the agreement of the meeting held on October 29, 2020

The key information is the dissemination of *products* and *services* to the general public, particularly when we are entering into the blue economy contribution for economic development in the United Republic of Tanzania. 

## New Member
Dr. Mwanahija Shalli


```{r}
library(tmap)
library(leaflet)
require(tidyverse)
require(raster)

data(Europe)
```

```{r}


data(World, metro)
metro$growth <- (metro$pop2020 - metro$pop2010) / (metro$pop2010 * 10) * 100

tmap_mode(mode = "view")
# ttm()
tm_shape(metro) +
    tm_bubbles(size = "pop2010", col = "growth", 
               border.col = "black", border.alpha = .5, 
               style="fixed", breaks=c(-Inf, seq(0, 6, by=2), Inf),
               palette="-RdYlBu", contrast=1, 
               title.size="Metro population", 
               title.col="Growth rate (%)", id="name", 
               popup.vars=c("Population (2010)"="pop2010", "Population (2020)"="pop2020", "Growth (%)"="growth"),
               popup.format=list(growth=list(digits=4)))
```

```{r}
tunas = read_csv("coastal_dashboard/data/tunas.csv") 

tunas %>% 
  filter(gear == "LL" & gear > 1000) %>% 
  mutate(cpue = cpue*100) %>%
  drop_na(lon) %>% 
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>% 
  sample_n(size = 300) %>%
  tm_shape() + 
  tm_bubbles(size = "weight", 
             col = "cpue", 
             alpha = 1,
             border.col = "black", border.alpha = .5, 
             style="fixed", 
             breaks=c(-Inf, seq(0, 150, by=40), Inf),
             palette="-RdYlBu", contrast=1, 
             title.size="Metro population", 
             title.col="Catch rate (Kg/100 hook)", 
             id="category_name", 
             popup.vars=c("Hooks" = "fishing_effort", "Number of fish" = "number", "Weight (kg)" = "weight"))




```



```{r}
forecasts = rvest::read_html("https://forecast.weather.gov/MapClick.php?lat=37.7771&lon=-122.4196#.Xl0j6BNKhTY") %>% 
  rvest::html_node(".temp") %>% 
  rvest::html_text()

```


```{r}

rvest::read_html("https://www.meteo.go.tz/?region=mjini-magharibi") %>% rvest::html_element("p")

```



```{r}
sst = raster::raster("modis_sst.nc") 

sst %>% raster::plot()
```

```{r}

pal = leaflet::colorNumeric(c("#7f007f", "#0000ff",  "#007fff", "#00ffff", "#00bf00", "#7fdf00",
"#ffff00", "#ff7f00", "#ff3f00", "#ff0000", "#bf0000"), values(sst),  na.color = "transparent")

sst.color = c("#7f007f", "#0000ff",  "#007fff", "#00ffff", "#00bf00", "#7fdf00",
"#ffff00", "#ff7f00", "#ff3f00", "#ff0000", "#bf0000")

```


```{r}

leaflet() %>% 
  addTiles() %>%
  addRasterImage(x = sst , 
                 colors = pal, 
                 opacity = 1) %>%
  addLegend(pal = pal, values = values(sst),
    title = "Temperature")
```





```{r}
tz.bbox = extent(38, 45, -14, 0)
sst.tz = sst %>% raster::crop(tz.bbox)
sst.tz %>% setMinMax()

sst.tz[sst.tz < 26 | sst.tz > 30] = NA

```


```{r}

pal2 = leaflet::colorNumeric(c("#7f007f", "#0000ff",  "#007fff", "#00ffff", "#00bf00", "#7fdf00",
"#ffff00", "#ff7f00", "#ff3f00", "#ff0000", "#bf0000"), values(sst.tz),  na.color = "transparent")

leaflet() %>% 
  addTiles() %>%
  addRasterImage(x = sst.tz , 
                 colors = pal2, 
                 opacity = 1) %>%
  addLegend(pal = pal2, values = values(sst.tz),
    title = "Temperature")
```



```{r}

tmap_mode(mode = "view")

sst.tz %>% 
tm_shape() +
  tm_raster(title = "SST", palette = color1, n = 20)

```


## windstress

```{r}
tidync::tidync("wind_stress_meridional_monthly_maps.nc")
wind = raster::raster("wind_stress_meridional_monthly_maps.nc")
wind[["January"]]

wind %>% setMinMax()
```


```{r}
tidync::tidync("wind_stress_curl_monthly_maps.nc", varname = "january")

oceanmap::nc2raster("wind_stress_curl_monthly_maps.nc")



wind = raster::stack("wind_stress_curl_monthly_maps.nc", varname = "february")
# wind = raster::stack("wind_stress_curl_monthly_maps.nc")


wind = wind %>% 
  raster::crop(tz.bbox)

wind[wind < -30 | wind > 30] = NA


wind %>% 
  raster::plot()




```

